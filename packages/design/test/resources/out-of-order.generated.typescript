/* This file is automatically generated. It gets overwritten on build */
import {CompleteWorkflow, WrongTimingError, WorkflowBase} from "@gamgee/run";
import {StateStore} from "@gamgee/interfaces/store";
import {WorkflowTask} from "@gamgee/interfaces/task";

import {MyTaskPayload} from "./out-of-order";

export abstract class OooWorkflowBase extends WorkflowBase {
    protected constructor() {
        super('OooWorkflow');

        super._registerStep({ name: 'myTask', run: this.invokeMyTask, attempts: 1, backoffMs: 1000 });
    }

    async submit(payload: MyTaskPayload, store: StateStore, uniqueInstanceId?: string): Promise<string> {
        const task = await super._enqueue('myTask', payload, store, uniqueInstanceId);
        return task.instanceId;
    }

    private async invokeMyTask(payload: MyTaskPayload): Promise<CompleteWorkflow> {
        await this.myTask(payload);
        return Promise.resolve(CompleteWorkflow);
    }

    abstract myTask(payload: MyTaskPayload): Promise<void>;

    protected _registerStep() {
        throw new WrongTimingError();
    }

    protected _enqueue(): Promise<WorkflowTask> {
        throw new WrongTimingError();
    }
}